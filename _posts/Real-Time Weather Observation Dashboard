---
title: 'Real-Time Weather Observation Dashboard'
date: 2025-12-08
permalink: /posts/2025/12/blog-post-3/
tags:
  - Real-Time Weather Tracking: Building a Dynamic Observation Dashboard
---

While forecasts predict the future, this project focuses on the "now." Using the TMD's WeatherToday/v2 API, I created a script to monitor real-time weather observations from stations across Thailand. This project highlights the ability to transform raw sensor data into professional-grade visual insights.

Key features include:

Smart Key Discovery: I implemented an automated key-hunting algorithm to robustly identify forecast data within the API, regardless of inconsistent key naming conventions (e.g., handling variations like AirTemperature vs. Temperature).

Data Science Visualization:

Heatmap Bar Chart: A top-15 ranking of the hottest stations, utilizing gradient coloring (yellow to red) to visually represent heat intensity.

Multi-Variable Bubble Map: An advanced geospatial plot where location is mapped to coordinates, color represents temperature, and bubble size indicates rainfall intensity.

This project serves as a case study in handling real-time data streams and creating multi-dimensional visualizations using Seaborn and Matplotlib.
<img width="1189" height="590" alt="image" src="https://github.com/user-attachments/assets/ec9496f4-9cbf-4cd4-b84d-dca618e3f3ef" />

<img width="793" height="1276" alt="image" src="https://github.com/user-attachments/assets/17b568a0-f59c-432d-9456-52202c8c7bd9" />

---python
import requests
import pandas as pd
import matplotlib.pyplot as plt
import geopandas as gpd
import seaborn as sns # Added library for beautiful graphs
import urllib3
import numpy as np

# Set font and style for a professional look
sns.set_style("whitegrid")
urllib3.disable_warnings()

# ==========================================
# 1. API Configuration
# ==========================================
UID = "api"             # Replace with your actual UID
UKEY = "api12345"       # Replace with your actual UKEY
BASE_URL = "http://data.tmd.go.th/api"

def get_tmd_data(endpoint):
    url = f"{BASE_URL}/{endpoint}"
    params = {'uid': UID, 'ukey': UKEY, 'format': 'json'}
    try:
        response = requests.get(url, params=params, timeout=30, verify=False)
        return response.json()
    except Exception as e:
        print(f"âŒ Connection Error: {e}")
        return None

# ==========================================
# 2. Main Function (Advanced Visuals)
# ==========================================
def process_weather_visuals_upgrade():
    print("\n" + "="*50)
    print("ðŸŽ¨ Generating Professional Visualizations...")
    print("="*50)
    
    # Fetch 3-hour forecast data (No.3) or try DailyWeatherForecast/v2 (No.1) if this fails
    data = get_tmd_data("Weather3Hours/v2")
    
    if not data: return

    # --- Robust Parsing Section ---
    root = data.get('Weather3Hours', data)
    stations_container = root.get('Stations', {})
    station_list = stations_container.get('Station', [])
    if isinstance(station_list, dict): station_list = [station_list]
    
    rows = []
    # Automatic Key Search Keywords
    keywords = ['Forecast', 'Weather', 'Temp', 'Value', 'Observation'] 
    
    # Find Target Key
    target_key = ""
    if station_list:
        keys = list(station_list[0].keys())
        for k in keys:
            for kw in keywords:
                if kw in k:
                    target_key = k
                    break
            if target_key: break
            
    print(f"Fetching data from Key: {target_key}")

    for st in station_list:
        name = st.get('StationNameEnglish', '').strip()
        lat = st.get('Latitude', 0)
        lon = st.get('Longitude', 0)
        
        forecasts = st.get(target_key, st.get('Observation', []))
        if isinstance(forecasts, dict): forecasts = [forecasts]
        
        if forecasts:
            latest = forecasts[0]
            # Attempt to extract values using various possible keys
            temp = latest.get('AirTemperature', latest.get('Temperature', latest.get('MaximumTemperature', 0)))
            rain = latest.get('Rainfall', latest.get('Rainfall24Hour', latest.get('RainfallPercentage', 0)))
            
            try:
                rows.append({
                    'station': name,
                    'lat': float(lat),
                    'lon': float(lon),
                    'temp': float(temp),
                    'rain': float(rain)
                })
            except:
                continue

    if not rows:
        print("âŒ No valid numerical data found for plotting")
        return

    df = pd.DataFrame(rows)
    print(f"âœ… Data preparation successful: {len(df)} stations")

    # ========================================================
    # ðŸ“Š GRAPH 1: Heatmap Bar Chart
    # ========================================================
    # Select Top 15 Hottest Stations
    top_hot = df.sort_values('temp', ascending=False).head(15)
    
    plt.figure(figsize=(12, 6))
    
    # Create Color Palette based on temperature (Cool=Yellow, Hot=Dark Red)
    norm = plt.Normalize(df['temp'].min(), df['temp'].max())
    colors = plt.cm.YlOrRd(norm(top_hot['temp']))
    
    bars = plt.bar(top_hot['station'], top_hot['temp'], color=colors, edgecolor='black', alpha=0.9)
    
    # Add labels on top of bars
    for bar in bars:
        height = bar.get_height()
        plt.text(bar.get_x() + bar.get_width()/2., height + 0.1,
                 f'{height:.1f}Â°C', ha='center', va='bottom', fontsize=9, fontweight='bold')

    plt.title("Top 15 Hottest Stations Forecast", fontsize=16, fontweight='bold')
    plt.ylabel("Temperature (Â°C)", fontsize=12)
    plt.xticks(rotation=45, ha='right')
    plt.grid(axis='y', linestyle='--', alpha=0.5)
    plt.tight_layout()
    plt.show()
    print("Heatmap Bar Chart displayed successfully")

    # ========================================================
    # ðŸ—ºï¸ MAP 2: Advanced Bubble Map
    # ========================================================
    try:
        # Load Base Map
        gdf = gpd.read_file("https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json")
        
        fig, ax = plt.subplots(1, 1, figsize=(10, 16))
        
        # 1. Draw Thailand Background (Light Cream color)
        gdf.plot(ax=ax, color='#fdfcf0', edgecolor='darkgrey', linewidth=0.8)
        
        # 2. Draw Data Points (Bubble Plot)
        # Color (c) = Temperature
        # Size (s) = Rainfall (Small dots if no rain)
        
        # Prepare dot sizes (Ensure minimum size is visible)
        sizes = df['rain'].apply(lambda x: x*20 + 30 if x > 0 else 30)
        
        scatter = ax.scatter(df['lon'], df['lat'], 
                             c=df['temp'],           # Color by Temp
                             s=sizes,                # Size by Rain
                             cmap='coolwarm',        # Palette Blue->Red
                             edgecolor='black',      # Black border
                             linewidth=0.5,
                             alpha=0.8)              # Slightly transparent
        
        # 3. Add Colorbar on the side
        cbar = plt.colorbar(scatter, ax=ax, fraction=0.03, pad=0.04)
        cbar.set_label('Temperature (Â°C)', fontsize=12)
        
        # 4. Add Title and Annotations
        plt.title("Thailand Weather Map: Temp (Color) & Rain (Size)", fontsize=16, fontweight='bold')
        plt.axis('off') # Hide x, y axes
        
        # Add annotation box
        textstr = 'Note:\n- Color: Red=Hot, Blue=Cool\n- Circle Size: Bigger=More Rain'
        props = dict(boxstyle='round', facecolor='white', alpha=0.8)
        ax.text(0.02, 0.02, textstr, transform=ax.transAxes, fontsize=10,
                verticalalignment='bottom', bbox=props)

        plt.show()
        print("Bubble Map displayed successfully")
        
    except Exception as e:
        print(f"Map Error: {e}")

# Run Function
if __name__ == "__main__":
    process_weather_visuals_upgrade()
---
======



